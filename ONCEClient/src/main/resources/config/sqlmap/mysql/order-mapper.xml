<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="once.order.dao.OrderDAO">

	<!-- order insert -->
	 <insert id="addOrder" parameterType="OrderVO">
    	insert into orderList (memNo, count, storeNo, totalPrice, oriPrice, salePrice, date)
    	values (#{memNo}, #{count}, #{storeNo}, #{totalPrice}, #{oriPrice}, #{salePrice}, curdate())
    </insert>
    
	 <insert id="addOrderDetail" parameterType="OrderDetailVO">
    	<choose>
 			<when test="salePrice != 0">
		 		insert into OrderDetail (orderNo, price, detailNo, count) values (#{orderNo}, #{salePrice}, #{detailNo}, #{count})
 			</when>
 			<otherwise>
 				insert into OrderDetail (orderNo, price, detailNo, count) values (#{orderNo}, #{price}, #{detailNo}, #{count})
 			</otherwise>
 		</choose>
    </insert>
    
     <select id="findNum" resultType="INT">
    	select Max(orderNo)
    	from orderList
    </select>
    
    <update id="updateFloor" parameterType="OrderVO">
    	update orderList
    	set floor = #{floor}
    	where orderNo = #{orderNo}
    </update>
    
    <!-- 주문/수령 -->
    <select id="showOrderList" parameterType="INT" resultType="OrderVO">
		select orderNo, status, count, storeNo, date_format(date, '%y-%m-%d') as date, totalPrice, imgSaveName, imgSize, itemName, storeName
 		from Orders
 		where memNo = #{memNo} and  date=curdate();
	</select>
	
	 <!-- 주문/수령_상세정보-->
	<select id="showDetailList" parameterType="INT" resultType="OrderDetailVO">
		select itemName, size, color, count, price, imgSaveName, imageSize
		from detailList
		where orderNo = #{orderNo}
	</select>
	
	<!-- 오늘 주문 & !수령완료 한 내역 보기  -->
    <select id="todayNotReceipt" parameterType="INT" resultType="INT">
		select count(*)
 		from OrderList
 		where memNo = #{memNo} and  date=curdate() and status not in ('수령 완료');
	</select>
	
	<!-- info 확인 -->
    <select id="getFloor" parameterType="INT" resultType="String">
		select floor
 		from OrderList
 		where memNo = #{memNo} and date=curdate() and status not in ('수령 완료')
 		group by memNo having min(orderNo);
	</select>
	
</mapper>